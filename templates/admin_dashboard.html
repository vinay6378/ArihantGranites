{% extends "base.html" %}

{% block title %}Admin Dashboard - Arihant Granites{% endblock %}

{% block content %}
<!-- Admin Dashboard Header -->
<section class="py-16 bg-gradient-to-br from-gray-900 via-amber-900 to-yellow-800 text-white">
  <div class="container mx-auto px-4">
    <div class="flex items-center justify-between">
      <div>
        <h1 class="text-4xl font-bold mb-4">Admin Dashboard</h1>
        <p class="text-xl text-yellow-100">Welcome back, {{ admin_info[3] }}! (ID: {{ admin_info[0] }})</p>
      </div>
      <div class="text-right">
        <div class="text-sm text-yellow-200">Last Login</div>
        <div class="text-lg font-semibold">{{ admin_info[6][:10] if admin_info[6] else 'Never' }}</div>
      </div>
    </div>
  </div>
</section>

<!-- Statistics Cards -->
<section class="py-12 bg-gray-50">
  <div class="container mx-auto px-4">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
      <div class="kesariya-card p-6 text-center group hover:scale-105 transition-all duration-300">
        <div class="w-16 h-16 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center text-2xl text-white mx-auto mb-4">
          üìû
        </div>
        <div class="text-3xl font-bold text-gray-800 mb-2">{{ stats.total_contacts }}</div>
        <div class="text-gray-600">Contact Inquiries</div>
      </div>
      
      <div class="kesariya-card p-6 text-center group hover:scale-105 transition-all duration-300">
        <div class="w-16 h-16 bg-gradient-to-br from-yellow-400 to-yellow-600 rounded-full flex items-center justify-center text-2xl text-white mx-auto mb-4">
          ‚≠ê
        </div>
        <div class="text-3xl font-bold text-gray-800 mb-2">{{ stats.total_reviews }}</div>
        <div class="text-gray-600">Customer Reviews</div>
      </div>
      
      <div class="kesariya-card p-6 text-center group hover:scale-105 transition-all duration-300">
        <div class="w-16 h-16 bg-gradient-to-br from-purple-400 to-purple-600 rounded-full flex items-center justify-center text-2xl text-white mx-auto mb-4">
          üìä
        </div>
        <div class="text-3xl font-bold text-gray-800 mb-2">{{ stats.avg_rating }}</div>
        <div class="text-gray-600">Average Rating</div>
      </div>
    </div>
  </div>
</section>

<!-- Quick Actions -->
<section class="py-12">
  <div class="container mx-auto px-4">
    <h2 class="text-3xl font-bold text-center mb-8">Quick Actions</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
      <a href="{{ url_for('admin_contacts_management') }}" class="kesariya-card p-6 text-center group hover:scale-105 transition-all duration-300">
        <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center text-2xl text-blue-600 mx-auto mb-4">
          üìã
        </div>
        <h3 class="text-xl font-semibold mb-2">Manage Contacts</h3>
        <p class="text-gray-600">Systematic contact management with deletion</p>
      </a>
      
      <a href="{{ url_for('admin_reviews_management') }}" class="kesariya-card p-6 text-center group hover:scale-105 transition-all duration-300">
        <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center text-2xl text-green-600 mx-auto mb-4">
          ‚≠ê
        </div>
        <h3 class="text-xl font-semibold mb-2">Manage Reviews</h3>
        <p class="text-gray-600">Feature reviews on home page & manage content</p>
      </a>
      
      <a href="{{ url_for('admin_products_management') }}" class="kesariya-card p-6 text-center group hover:scale-105 transition-all duration-300">
        <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center text-2xl text-purple-600 mx-auto mb-4">
          üèóÔ∏è
        </div>
        <h3 class="text-xl font-semibold mb-2">Manage Products</h3>
        <p class="text-gray-600">Add, edit, and remove granite products</p>
      </a>
      
      <a href="{{ url_for('admin_upload') }}" class="kesariya-card p-6 text-center group hover:scale-105 transition-all duration-300">
        <div class="w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center text-2xl text-yellow-600 mx-auto mb-4">
          üì§
        </div>
        <h3 class="text-xl font-semibold mb-2">Upload Images</h3>
        <p class="text-gray-600">Add new granite images to the gallery</p>
      </a>
    </div>
  </div>
</section>

<!-- Recent Activity -->
<section class="py-12 bg-gray-50">
  <div class="container mx-auto px-4">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
      <!-- Recent Contacts -->
      <div class="kesariya-card p-6">
        <h3 class="text-2xl font-bold mb-6 flex items-center justify-between">
          <div class="flex items-center">
            <span class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 mr-3">üìû</span>
            Recent Contact Inquiries
          </div>
          <div class="flex items-center space-x-2">
            <span class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium">{{ stats.new_contacts_today }}</span>
            <span class="text-sm text-gray-500">Today</span>
          </div>
        </h3>
        
        <!-- Contact Statistics -->
        <div class="grid grid-cols-3 gap-4 mb-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg">
          <div class="text-center">
            <div class="text-2xl font-bold text-blue-600">{{ stats.pending_contacts }}</div>
            <div class="text-xs text-gray-600">Pending</div>
          </div>
          <div class="text-center">
            <div class="text-2xl font-bold text-yellow-600">{{ stats.responded_contacts }}</div>
            <div class="text-xs text-gray-600">Responded</div>
          </div>
          <div class="text-center">
            <div class="text-2xl font-bold text-green-600">{{ stats.converted_contacts }}</div>
            <div class="text-xs text-gray-600">Converted</div>
          </div>
        </div>
        
        <div class="space-y-3">
          {% for contact in recent_contacts %}
          <div class="p-4 bg-white rounded-lg border-l-4 {% if contact[4] == 'urgent' %}border-red-500{% else %}border-blue-500{% endif %} hover:shadow-md transition-all duration-300">
            <div class="flex items-start justify-between mb-3">
              <div class="flex-1">
                <div class="flex items-center mb-2">
                  <div class="font-semibold text-gray-800 text-lg">{{ contact[0] }}</div>
                  {% if contact[4] == 'urgent' %}
                  <span class="ml-2 px-2 py-1 bg-red-100 text-red-700 rounded-full text-xs font-bold animate-pulse">URGENT</span>
                  {% endif %}
                </div>
                <div class="text-sm text-gray-600 mb-1">{{ contact[1] }}</div>
                <div class="text-xs text-gray-500">{{ contact[2][:10] if contact[2] else 'N/A' }}</div>
              </div>
              <div class="text-right ml-4">
                <div class="text-xs text-gray-500 mb-1">{{ contact[3][:10] if contact[3] else 'N/A' }}</div>
                {% if contact[4] %}
                <div class="text-xs px-2 py-1 bg-purple-100 text-purple-700 rounded-full">{{ contact[4] }}</div>
                {% endif %}
              </div>
            </div>
            
            <!-- Contact Details -->
            <div class="grid grid-cols-2 gap-4 text-sm text-gray-600">
              {% if contact[5] %}
              <div class="flex items-center">
                <svg class="w-4 h-4 mr-2 text-green-500" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"/>
                </svg>
                <span>{{ contact[5] }}</span>
              </div>
              {% endif %}
              {% if contact[6] %}
              <div class="flex items-center">
                <svg class="w-4 h-4 mr-2 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                </svg>
                <span>{{ contact[6] }}</span>
              </div>
              {% endif %}
            </div>
            
            <!-- Message Preview -->
            <div class="mt-3 p-3 bg-gray-50 rounded text-sm text-gray-700">
              {{ (contact[7][:150] + '...') if contact[7] and contact[7]|length > 150 else (contact[7] if contact[7] else 'No message') }}
            </div>
            
            <!-- Action Buttons -->
            <div class="flex gap-2 mt-3">
              <button onclick="markContactResponded('{{ contact[8] if contact[8] else '' }}')" class="px-3 py-1 bg-green-100 text-green-700 rounded text-xs hover:bg-green-200 transition-colors duration-300">
                Mark Responded
              </button>
              <button onclick="markContactConverted('{{ contact[8] if contact[8] else '' }}')" class="px-3 py-1 bg-blue-100 text-blue-700 rounded text-xs hover:bg-blue-200 transition-colors duration-300">
                Mark Converted
              </button>
              <a href="mailto:{{ contact[1] if contact[1] else '' }}" class="px-3 py-1 bg-amber-100 text-amber-700 rounded text-xs hover:bg-amber-200 transition-colors duration-300">
                Reply Email
              </a>
            </div>
          </div>
          {% endfor %}
        </div>
        
        <div class="mt-6 text-center">
          <a href="{{ url_for('admin_contacts') }}" class="inline-flex items-center px-6 py-3 bg-amber-600 text-white rounded-lg font-semibold hover:bg-amber-700 transition-all duration-300">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7m0 0a4 4 0 018 0z"></path>
            </svg>
            View All Contact Submissions
          </a>
        </div>
      </div>
      
      <!-- Recent Reviews -->
      <div class="kesariya-card p-6">
        <h3 class="text-2xl font-bold mb-6 flex items-center">
          <span class="w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center text-yellow-600 mr-3">‚≠ê</span>
          Recent Reviews
        </h3>
        <div class="space-y-4">
          {% for review in recent_reviews %}
          <div class="p-4 bg-gray-50 rounded-lg">
            <div class="flex items-center justify-between mb-2">
              <div class="font-semibold text-gray-800">{{ review[0] }}</div>
              <div class="flex text-yellow-500">
                {% for i in range(review[1]) %}
                  <span>‚≠ê</span>
                {% endfor %}
              </div>
            </div>
            <div class="text-sm text-gray-600 mb-2">{{ review[2][:100] }}{% if review[2]|length > 100 %}...{% endif %}</div>
            <div class="text-xs text-gray-500">{{ review[3][:10] }}</div>
          </div>
          {% endfor %}
        </div>
        <div class="mt-4 text-center">
          <a href="{{ url_for('reviews') }}" class="text-amber-600 hover:text-amber-700 font-semibold">
            View All Reviews ‚Üí
          </a>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Security Logs -->
<section class="py-12 bg-gray-50">
  <div class="container mx-auto px-4">
    <div class="kesariya-card p-6">
      <h3 class="text-2xl font-bold mb-6 flex items-center">
        <span class="w-8 h-8 bg-red-100 rounded-full flex items-center justify-center text-red-600 mr-3">üîí</span>
        Recent Security Activity
      </h3>
      <div class="space-y-4">
        {% for log in security_logs %}
        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
          <div class="flex-1">
            <div class="flex items-center">
              <div class="w-2 h-2 rounded-full mr-3 {% if log[1] %}bg-green-500{% else %}bg-red-500{% endif %}"></div>
              <div class="font-semibold text-gray-800">{{ log[0].replace('_', ' ').title() }}</div>
              <div class="ml-4 text-sm text-gray-500">{{ log[2][:16] if log[2] else 'Unknown' }}</div>
            </div>
            <div class="text-sm text-gray-600 mt-1">
              IP: {{ log[3] or 'Unknown' }}{% if log[4] %} - {{ log[4] }}{% endif %}
            </div>
          </div>
          <div class="ml-4">
            {% if log[1] %}
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                Success
              </span>
            {% else %}
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                Failed
              </span>
            {% endif %}
          </div>
        </div>
        {% else %}
        <div class="text-center text-gray-500 py-8">
          <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <p class="mt-2">No security activity recorded</p>
        </div>
        {% endfor %}
      </div>
      <div class="mt-4 text-center">
        <a href="/admin/profile" class="text-amber-600 hover:text-amber-700 font-semibold">
          View Full Security Log ‚Üí
        </a>
      </div>
    </div>
  </div>
</section>

<!-- System Status -->
<section class="py-12">
  <div class="container mx-auto px-4">
    <div class="kesariya-card p-8">
      <h3 class="text-2xl font-bold mb-6 text-center">System Status</h3>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="text-center">
          <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center text-2xl text-green-600 mx-auto mb-4">
            ‚úÖ
          </div>
          <h4 class="text-lg font-semibold mb-2">Database</h4>
          <p class="text-gray-600">Online & Healthy</p>
        </div>
        
        <div class="text-center">
          <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center text-2xl text-green-600 mx-auto mb-4">
            ‚úÖ
          </div>
          <h4 class="text-lg font-semibold mb-2">File System</h4>
          <p class="text-gray-600">All Images Accessible</p>
        </div>
        
        <div class="text-center">
          <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center text-2xl text-green-600 mx-auto mb-4">
            ‚úÖ
          </div>
          <h4 class="text-lg font-semibold mb-2">Authentication</h4>
          <p class="text-gray-600">Secure & Active</p>
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock %}
