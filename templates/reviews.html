{% extends 'base.html' %}
{% block title %}Customer Reviews â€“ Arihant Granites{% endblock %}
{% block content %}
<!-- Hero Section for Reviews -->
<section class="relative py-20 bg-gradient-to-br from-amber-900 via-yellow-800 to-amber-700 overflow-hidden">
  <div class="absolute inset-0 bg-black bg-opacity-30"></div>
  <div class="container mx-auto px-4 relative z-10 text-center">
    <h1 class="text-5xl md:text-6xl font-bold text-white mb-6 animate-fade-in-up">
      <span class="bg-gradient-to-r from-yellow-300 to-yellow-100 bg-clip-text text-transparent">
        Customer Reviews
      </span>
    </h1>
    <p class="text-xl text-yellow-100 max-w-2xl mx-auto animate-fade-in-up-delay">
      Hear what our valued customers say about our premium granite products and exceptional service
    </p>
  </div>
  <!-- Floating Stars -->
  <div class="absolute inset-0 overflow-hidden">
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
  </div>
</section>

<section class="py-16 container mx-auto px-4">
  
  <!-- Review Form -->
  <div class="max-w-2xl mx-auto mb-12">
    <div class="kesariya-card p-8 reveal">
      <h2 class="kesariya-title text-3xl mb-6 text-center">Share Your Experience</h2>
      
      {% with messages = get_flashed_messages() %}
        {% if messages %}
          <div class="mb-6 p-4 bg-green-100 text-green-800 rounded-lg border-l-4 border-green-500 animate-fade-in-up">
            {% for message in messages %}
              <div class="flex items-center">
                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                </svg>
                {{ message }}
              </div>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}
      
      <form method="post" id="review-form" class="space-y-6">
        <div class="grid md:grid-cols-2 gap-6">
          <div class="form-group">
            <label for="name" class="block text-sm font-medium text-gray-700 mb-2">Name *</label>
            <input type="text" id="name" name="name" required
                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all duration-300"
                   placeholder="Your full name">
            <div class="error-message text-red-500 text-sm mt-1 hidden"></div>
          </div>
          <div class="form-group">
            <label for="email" class="block text-sm font-medium text-gray-700 mb-2">Email *</label>
            <input type="email" id="email" name="email" required
                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all duration-300"
                   placeholder="your.email@example.com">
            <div class="error-message text-red-500 text-sm mt-1 hidden"></div>
          </div>
        </div>
        
        <div class="form-group">
          <label for="phone" class="block text-sm font-medium text-gray-700 mb-2">Phone *</label>
          <input type="tel" id="phone" name="phone" required
                 class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all duration-300"
                 placeholder="+91 98765 43210">
          <div class="error-message text-red-500 text-sm mt-1 hidden"></div>
        </div>
        
        <div class="form-group">
          <label class="block text-sm font-medium text-gray-700 mb-2">Rating *</label>
          <div class="flex items-center space-x-1">
            <!-- Interactive 5-Star Rating System -->
            <div class="star-rating-container" data-rating="0">
              <button type="button" class="star-btn" data-value="1" aria-label="1 star">
                <svg class="w-8 h-8 text-gray-300 hover:text-yellow-400 transition-colors duration-200" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                </svg>
              </button>
              <button type="button" class="star-btn" data-value="2" aria-label="2 stars">
                <svg class="w-8 h-8 text-gray-300 hover:text-yellow-400 transition-colors duration-200" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                </svg>
              </button>
              <button type="button" class="star-btn" data-value="3" aria-label="3 stars">
                <svg class="w-8 h-8 text-gray-300 hover:text-yellow-400 transition-colors duration-200" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                </svg>
              </button>
              <button type="button" class="star-btn" data-value="4" aria-label="4 stars">
                <svg class="w-8 h-8 text-gray-300 hover:text-yellow-400 transition-colors duration-200" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                </svg>
              </button>
              <button type="button" class="star-btn" data-value="5" aria-label="5 stars">
                <svg class="w-8 h-8 text-gray-300 hover:text-yellow-400 transition-colors duration-200" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                </svg>
              </button>
            </div>
            <div class="ml-3">
              <span class="rating-text text-sm font-medium text-gray-700">Click to rate</span>
              <div class="rating-label text-xs text-gray-500 mt-1"></div>
            </div>
          </div>
          <!-- Hidden input to store rating value -->
          <input type="hidden" id="rating-value" name="stars" value="0" required>
          <div class="error-message text-red-500 text-sm mt-1 hidden">Please select a rating</div>
        </div>
        
        <div class="form-group">
          <label for="message" class="block text-sm font-medium text-gray-700 mb-2">Your Review *</label>
          <textarea id="message" name="message" rows="5" required
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all duration-300 resize-none"
                    placeholder="Tell us about your experience with Arihant Granite..."></textarea>
          <div class="text-sm text-gray-500 mt-1">Minimum 10 characters required</div>
          <div class="error-message text-red-500 text-sm mt-1 hidden"></div>
        </div>
        
        <button type="submit" class="w-full kesariya-btn text-lg py-4 relative overflow-hidden">
          <span class="relative z-10 flex items-center justify-center">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path>
            </svg>
            Submit Review
          </span>
        </button>
      </form>
    </div>
  </div>
  
  <!-- Display Reviews -->
  <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
    {% for review in reviews %}
    <div class="kesariya-card p-6 hover:shadow-lg transition-shadow duration-300">
      <!-- Rating Display -->
      <div class="flex items-center justify-between mb-4">
        <div class="flex items-center">
          <div class="flex text-yellow-400">
            {% for i in range(5) %}
              {% if i < review[1] %}
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                </svg>
              {% else %}
                <svg class="w-5 h-5 text-gray-300" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                </svg>
              {% endif %}
            {% endfor %}
          </div>
          <span class="ml-2 text-sm font-semibold text-yellow-600">{{ review[1] }}.0</span>
        </div>
        <span class="text-xs text-gray-500">{{ review[3][:10] if review[3] else '' }}</span>
      </div>
      
      <!-- Review Content -->
      <p class="text-gray-700 mb-4 italic leading-relaxed">"{{ review[2] }}"</p>
      
      <!-- Reviewer Info -->
      <div class="flex items-center justify-between pt-4 border-t border-gray-200">
        <div class="flex items-center">
          <div class="w-10 h-10 bg-gradient-to-br from-amber-400 to-yellow-500 rounded-full flex items-center justify-center text-white font-bold mr-3">
            {{ review[0][0].upper() if review[0] else 'A' }}
          </div>
          <div>
            <div class="font-semibold text-yellow-800">{{ review[0] }}</div>
            <div class="text-xs text-gray-500">Verified Customer</div>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  
  {% if not reviews %}
  <div class="text-center text-gray-600 reveal">
    <p>No reviews yet. Be the first to share your experience!</p>
  </div>
  {% endif %}
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Enhanced 5-Star Rating System
    const ratingContainer = document.querySelector('.star-rating-container');
    const starButtons = document.querySelectorAll('.star-btn');
    const ratingValue = document.getElementById('rating-value');
    const ratingText = document.querySelector('.rating-text');
    const ratingLabel = document.querySelector('.rating-label');
    
    const ratingDescriptions = {
        1: 'Poor - Not satisfied',
        2: 'Fair - Could be better', 
        3: 'Good - Met expectations',
        4: 'Very Good - Exceeded expectations',
        5: 'Excellent - Outstanding service'
    };
    
    // Initialize rating system
    starButtons.forEach((button, index) => {
        const rating = index + 1;
        
        // Click event - set rating
        button.addEventListener('click', function(e) {
            e.preventDefault();
            setRating(rating);
        });
        
        // Mouse enter - preview rating
        button.addEventListener('mouseenter', function() {
            highlightStars(rating);
            updateRatingText(rating, true);
        });
    });
    
    // Mouse leave - restore selected rating
    ratingContainer.addEventListener('mouseleave', function() {
        const currentRating = parseInt(ratingValue.value);
        highlightStars(currentRating);
        updateRatingText(currentRating, false);
    });
    
    function setRating(rating) {
        ratingValue.value = rating;
        ratingContainer.dataset.rating = rating;
        highlightStars(rating);
        updateRatingText(rating, false);
        
        // Clear any rating error
        const ratingGroup = ratingContainer.closest('.form-group');
        const errorDiv = ratingGroup.querySelector('.error-message');
        errorDiv.classList.add('hidden');
    }
    
    function highlightStars(rating) {
        starButtons.forEach((button, index) => {
            const starValue = index + 1;
            const svg = button.querySelector('svg');
            
            if (starValue <= rating) {
                svg.classList.remove('text-gray-300');
                svg.classList.add('text-yellow-400');
            } else {
                svg.classList.remove('text-yellow-400');
                svg.classList.add('text-gray-300');
            }
        });
    }
    
    function updateRatingText(rating, isHover) {
        if (rating > 0) {
            ratingText.textContent = `${rating} out of 5 stars`;
            ratingLabel.textContent = ratingDescriptions[rating];
            ratingText.classList.remove('text-gray-700');
            ratingText.classList.add('text-yellow-600', 'font-medium');
        } else {
            ratingText.textContent = 'Click to rate';
            ratingLabel.textContent = '';
            ratingText.classList.remove('text-yellow-600', 'font-medium');
            ratingText.classList.add('text-gray-700');
        }
    }
    
    // Form Validation
    const form = document.getElementById('review-form');
    const inputs = form.querySelectorAll('input, textarea');
    
    inputs.forEach(input => {
        input.addEventListener('blur', function() {
            validateField(this);
        });
        
        input.addEventListener('input', function() {
            clearError(this);
        });
    });
    
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        let isValid = true;
        inputs.forEach(input => {
            if (!validateField(input)) {
                isValid = false;
            }
        });
        
        // Check if rating is selected
        const rating = parseInt(ratingValue.value);
        if (rating === 0) {
            const ratingGroup = ratingContainer.closest('.form-group');
            showError(ratingGroup, 'Please select a rating');
            isValid = false;
        }
        
        if (isValid) {
            // Show loading state
            const submitBtn = form.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<span class="inline-flex items-center"><svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>Submitting...</span>';
            submitBtn.disabled = true;
            
            // Submit form
            form.submit();
        }
    });
    
    function validateField(field) {
        const value = field.value.trim();
        const fieldName = field.name;
        let isValid = true;
        let errorMessage = '';
        
        // Clear previous errors
        clearError(field);
        
        if (field.hasAttribute('required') && !value) {
            const fieldLabel = fieldName.charAt(0).toUpperCase() + fieldName.slice(1).replace('_', ' ');
            errorMessage = `${fieldLabel} is required`;
            isValid = false;
        } else if (fieldName === 'email' && value && !isValidEmail(value)) {
            errorMessage = 'Please enter a valid email address';
            isValid = false;
        } else if (fieldName === 'phone' && value && !isValidPhone(value)) {
            errorMessage = 'Please enter a valid phone number';
            isValid = false;
        } else if (fieldName === 'message' && value && value.length < 10) {
            errorMessage = 'Review must be at least 10 characters long';
            isValid = false;
        }
        
        if (!isValid) {
            const formGroup = field.closest('.form-group');
            showError(formGroup, errorMessage);
        }
        
        return isValid;
    }
    
    function showError(formGroup, message) {
        const errorDiv = formGroup.querySelector('.error-message');
        errorDiv.textContent = message;
        errorDiv.classList.remove('hidden');
        
        const input = formGroup.querySelector('input, textarea');
        if (input) {
            input.classList.add('border-red-500');
        }
    }
    
    function clearError(field) {
        const formGroup = field.closest('.form-group');
        const errorDiv = formGroup.querySelector('.error-message');
        errorDiv.classList.add('hidden');
        field.classList.remove('border-red-500');
    }
    
    function isValidEmail(email) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email);
    }
    
    function isValidPhone(phone) {
        const phoneRegex = /^[\+]?[1-9][\d]{0,15}$/;
        return phoneRegex.test(phone.replace(/\s/g, ''));
    }
    
    // Scroll reveal animation
    const reveals = document.querySelectorAll('.reveal');
    const revealObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('active');
            }
        });
    });
    
    reveals.forEach(reveal => {
        revealObserver.observe(reveal);
    });
});
</script>
{% endblock %}