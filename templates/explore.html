{% extends 'base.html' %}
{% block title %}Granite Varieties â€“ Arihant Granites{% endblock %}
{% block content %}
<section class="py-12 container mx-auto px-4">
  <div class="mb-8">
    <h1 class="text-4xl kesariya-title mb-4 text-center">Explore Our Granite Varieties</h1>
    <p class="text-center text-gray-600 mb-8 max-w-2xl mx-auto">Discover our premium collection of granite stones, perfect for your residential and commercial projects</p>
    
    <!-- Enhanced Search and Filter Bar -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
      <div class="grid grid-cols-1 lg:grid-cols-4 gap-4 items-end">
        <div class="lg:col-span-2">
          <label class="block text-sm font-medium text-gray-700 mb-2">Search Products</label>
          <div class="relative">
            <input type="text" id="product-search" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" placeholder="Search by name or type...">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
              </svg>
            </div>
          </div>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Category</label>
          <select id="product-filter" class="w-full py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
            <option value="">All Categories</option>
            {% for cat in listings|map(attribute='category')|unique %}
            <option value="{{ cat }}">{{ cat }}</option>
            {% endfor %}
          </select>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Sort By</label>
          <select id="sort-products" class="w-full py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
            <option value="name">Name (A-Z)</option>
            <option value="category">Category</option>
            <option value="availability">Availability</option>
          </select>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">View</label>
          <div class="flex gap-2">
            <button onclick="setViewMode('grid')" id="grid-view" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2v2a2 2 0 012 2h12a2 2 0 012-2V6a2 2 0 00-2-2H4z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h8m-4 0h8"></path>
              </svg>
            </button>
            <button onclick="setViewMode('list')" id="list-view" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
              </svg>
            </button>
          </div>
        </div>
      </div>
      
      <!-- Active Filters Display -->
      <div id="active-filters" class="mt-4 flex flex-wrap gap-2 text-sm"></div>
    </div>
  </div>
  <!-- Responsive Gallery -->
  <div id="product-gallery" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8">
    {% for listing in listings %}
    <div class="kesariya-card cursor-pointer group hover:shadow-xl transition-all duration-300 transform hover:scale-105" data-product-index="{{ loop.index0 }}" data-category="{{ listing.category }}" data-availability="{{ listing.availability }}">
      <div class="relative overflow-hidden">
        <img src="{{ listing.image }}" class="h-48 w-full object-cover rounded-t group-hover:scale-105 transition-transform duration-300" alt="{{ listing.title }} granite" loading="lazy">
        <div class="absolute top-2 right-2 bg-yellow-500 text-white px-2 py-1 rounded-full text-xs font-bold shadow-lg">
          {{ listing.category }}
        </div>
        {% if listing.availability == 'Limited Stock' %}
        <div class="absolute top-2 left-2 bg-red-500 text-white px-2 py-1 rounded-full text-xs font-bold shadow-lg animate-pulse">
          Limited Stock
        </div>
        {% endif %}
      </div>
      <div class="p-4">
        <h2 class="text-lg font-semibold kesariya-title mb-2 group-hover:text-indigo-600 transition-colors duration-200">{{ listing.title }}</h2>
        <p class="text-sm text-yellow-700 font-medium mb-3">{{ listing.category }}</p>
        <p class="text-sm text-gray-600 line-clamp-2 mb-4">{{ listing.description }}</p>
        
        <div class="space-y-3 mb-4">
          <div class="flex items-center justify-between">
            <span class="text-yellow-700 font-bold text-sm">Availability</span>
            <span class="text-sm font-medium {% if listing.availability == 'In Stock' %}text-green-600{% else %}text-red-600{% endif %}">
              {{ listing.availability }}
            </span>
          </div>
          
          <div class="flex items-center justify-between">
            <span class="text-gray-500 text-sm">Thickness</span>
            <span class="text-gray-700 font-medium text-sm">{{ listing.thickness }}</span>
          </div>
          
          <div class="flex items-center justify-between">
            <span class="text-gray-500 text-sm">Finish</span>
            <span class="text-gray-700 font-medium text-sm">{{ listing.finish }}</span>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  <!-- Product Details Modal -->
  <div id="product-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-xl shadow-xl max-w-2xl w-full p-6 relative m-4 max-h-[90vh] overflow-y-auto">
      <button id="close-modal-btn" class="absolute top-2 right-2 text-2xl text-gray-500 hover:text-gray-700">&times;</button>
      <div class="grid md:grid-cols-2 gap-6">
        <div>
          <img id="modal-img" src="" class="w-full h-64 object-cover rounded mb-4" alt="Product image">
        </div>
        <div>
          <h2 id="modal-title" class="text-2xl kesariya-title mb-2"></h2>
          <p id="modal-category" class="text-yellow-700 font-semibold mb-2"></p>
          <p id="modal-desc" class="mb-4 text-gray-600"></p>
          <div class="space-y-2 mb-4">
            <p id="modal-price" class="text-yellow-700 font-bold text-lg"></p>
            <p id="modal-availability" class="text-sm"></p>
            <p id="modal-thickness" class="text-sm text-gray-600"></p>
            <p id="modal-finish" class="text-sm text-gray-600"></p>
          </div>
          <div class="flex gap-2">
            <button class="kesariya-btn flex-1">Get Quote</button>
            <button class="bg-gray-200 text-gray-700 px-4 py-2 rounded hover:bg-gray-300 flex-1">Contact Us</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<script>
  // Enhanced product gallery functionality
  const products = {{ listings|tojson|safe }};
  let currentViewMode = 'grid';
  let currentFilters = {
    search: '',
    category: '',
    sort: 'name'
  };

  function setViewMode(mode) {
    currentViewMode = mode;
    const gallery = document.getElementById('product-gallery');
    
    // Update button states
    document.getElementById('grid-view').classList.toggle('bg-indigo-600', mode === 'grid');
    document.getElementById('grid-view').classList.toggle('text-white', mode === 'grid');
    document.getElementById('grid-view').classList.toggle('bg-gray-200', mode !== 'grid');
    document.getElementById('grid-view').classList.toggle('text-gray-700', mode !== 'grid');
    
    document.getElementById('list-view').classList.toggle('bg-indigo-600', mode === 'list');
    document.getElementById('list-view').classList.toggle('text-white', mode === 'list');
    document.getElementById('list-view').classList.toggle('bg-gray-200', mode !== 'list');
    document.getElementById('list-view').classList.toggle('text-gray-700', mode !== 'list');
    
    // Update gallery layout
    if (mode === 'list') {
      gallery.className = 'grid grid-cols-1 gap-6';
    } else {
      gallery.className = 'grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8';
    }
    
    renderGallery();
  }

  function updateActiveFilters() {
    const filtersDiv = document.getElementById('active-filters');
    let filterHTML = '';
    
    if (currentFilters.search) {
      filterHTML += `<span class="px-3 py-1 bg-indigo-100 text-indigo-700 rounded-full text-xs font-medium">Search: "${currentFilters.search}"</span>`;
    }
    if (currentFilters.category) {
      filterHTML += `<span class="px-3 py-1 bg-yellow-100 text-yellow-700 rounded-full text-xs font-medium">Category: ${currentFilters.category}</span>`;
    }
    if (currentFilters.sort !== 'name') {
      filterHTML += `<span class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium">Sort: ${currentFilters.sort}</span>`;
    }
    
    filtersDiv.innerHTML = filterHTML;
  }

  function sortProducts(products, sortBy) {
    const sorted = [...products];
    switch(sortBy) {
      case 'name':
        return sorted.sort((a, b) => a.title.localeCompare(b.title));
      case 'category':
        return sorted.sort((a, b) => a.category.localeCompare(b.category));
      case 'availability':
        return sorted.sort((a, b) => {
          const stockOrder = { 'In Stock': 0, 'Limited Stock': 1 };
          return stockOrder[a.availability] - stockOrder[b.availability];
        });
      default:
        return sorted;
    }
  }

  function filterProducts(products) {
    return products.filter(p => {
      const matchesSearch = !currentFilters.search || 
        p.title.toLowerCase().includes(currentFilters.search.toLowerCase()) ||
        p.description.toLowerCase().includes(currentFilters.search.toLowerCase());
      
      const matchesCategory = !currentFilters.category || p.category === currentFilters.category;
      
      return matchesSearch && matchesCategory;
    });
  }

  function renderGallery() {
    const search = document.getElementById('product-search').value.toLowerCase();
    const filter = document.getElementById('product-filter').value;
    const sortBy = document.getElementById('sort-products').value;
    
    currentFilters = { search, category: filter, sort: sortBy };
    updateActiveFilters();
    
    let filteredProducts = filterProducts(products);
    filteredProducts = sortProducts(filteredProducts, sortBy);
    
    const gallery = document.getElementById('product-gallery');
    let html = '';
    
    filteredProducts.forEach((p, i) => {
      const stockBadge = p.availability === 'Limited Stock' ? 
        '<div class="absolute top-2 left-2 bg-red-500 text-white px-2 py-1 rounded-full text-xs font-bold shadow-lg animate-pulse">Limited Stock</div>' : '';
      
      const availabilityClass = p.availability === 'In Stock' ? 'text-green-600' : 'text-red-600';
      
      if (currentViewMode === 'list') {
        html += `<div class="kesariya-card cursor-pointer group hover:shadow-xl transition-all duration-300 flex gap-6" data-product-index="${i}" data-category="${p.category}" data-availability="${p.availability}">
          <div class="w-32 h-32 flex-shrink-0">
            <img src="${p.image}" class="w-full h-full object-cover rounded-lg" alt="${p.title}" loading="lazy">
          </div>
          <div class="flex-1">
            <div class="flex justify-between items-start mb-2">
              <h3 class="text-lg font-semibold kesariya-title">${p.title}</h3>
              <span class="px-2 py-1 text-xs ${availabilityClass} rounded-full">${p.availability}</span>
            </div>
            <p class="text-sm text-yellow-700 font-medium mb-3">${p.category}</p>
            <p class="text-sm text-gray-600 line-clamp-3 mb-4">${p.description}</p>
            <div class="space-y-2">
              <div class="flex justify-between text-sm">
                <span class="text-gray-500">Thickness</span>
                <span class="text-gray-700 font-medium">${p.thickness}</span>
              </div>
              <div class="flex justify-between text-sm">
                <span class="text-gray-500">Finish</span>
                <span class="text-gray-700 font-medium">${p.finish}</span>
              </div>
            </div>
          </div>
        </div>`;
      } else {
        html += `<div class="kesariya-card cursor-pointer group hover:shadow-xl transition-all duration-300 transform hover:scale-105" data-product-index="${i}" data-category="${p.category}" data-availability="${p.availability}">
          <div class="relative overflow-hidden">
            <img src="${p.image}" class="h-48 w-full object-cover rounded-t group-hover:scale-105 transition-transform duration-300" alt="${p.title}" loading="lazy">
            <div class="absolute top-2 right-2 bg-yellow-500 text-white px-2 py-1 rounded-full text-xs font-bold shadow-lg">${p.category}</div>
            ${stockBadge}
          </div>
          <div class="p-4">
            <h3 class="text-lg font-semibold kesariya-title group-hover:text-indigo-600 transition-colors duration-200">${p.title}</h3>
            <p class="text-sm text-yellow-700 font-medium mb-3">${p.category}</p>
            <p class="text-sm text-gray-600 line-clamp-2 mb-4">${p.description}</p>
            <div class="space-y-3 mb-4">
              <div class="flex items-center justify-between">
                <span class="text-yellow-700 font-bold text-sm">Availability</span>
                <span class="text-sm font-medium ${availabilityClass}">${p.availability}</span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-gray-500 text-sm">Thickness</span>
                <span class="text-gray-700 font-medium text-sm">${p.thickness}</span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-gray-500 text-sm">Finish</span>
                <span class="text-gray-700 font-medium text-sm">${p.finish}</span>
              </div>
            </div>
          </div>
        </div>`;
      }
    });
    
    gallery.innerHTML = html;
  }

  // Initialize
  document.addEventListener('DOMContentLoaded', function() {
    renderGallery();
    
    // Event listeners
    document.getElementById('product-search').addEventListener('input', renderGallery);
    document.getElementById('product-filter').addEventListener('change', renderGallery);
    document.getElementById('sort-products').addEventListener('change', renderGallery);
  });
</script>
{% endblock %}